# in qa/prompt_templates.py

import random # <-- 在文件顶部导入 random 模块

# QA生成的 Prompt 模板集合
# 将原来的字符串值，改为包含多个字符串的列表
QA_PROMPTS = {
    # 通用回退
    "generic_q": [
        """你是一名教研专家，请根据提供的文本内容生成一个高质量的中文考题：\n要求：\n1. 只输出一道题的 问题 和 对应的 标准答案。\n2. 问题应与原文核心知识点高度相关，不要引入原文没有的事实。\n3. 问题末尾使用中文问号。\n4. 答案要简洁准确。\n\n原文：{text}\n\n输出格式：\n问题：...\n答案：...\n""",
        """请仔细阅读以下段落，并就其核心信息点，构建一个高质量的问答对。\n\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ],

    "definition_q": [
        """根据以下文本，为其中的一个核心概念生成一条‘是什么’或‘定义’类考题，并给出准确答案：\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n""",
        """如果让你对以下文本的主题进行定义式提问，你会如何问？请同时提供一个精准的答案。\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n""",
        """请将以下文本的核心内容，改写为一个定义清晰的问答对。\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ],

    "reason_q": [
        """根据以下文本，生成一条‘原因/原理/为什么’类问题，并给出简洁准确的解释：\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n""",
        """请深入分析以下文本，并提出一个关于其内在因果关系或逻辑推理的“为什么”类型的问题，并给出解释性的回答。\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ],
    
    # ... 为 compare_q, apply_q, calculate_q 也各自添加1-2个不同措辞的模板 ...
    "compare_q": [
        """根据以下文本，生成一条比较或区别类考题（例如 X 与 Y 的区别），并给出明确对比答案：\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n""",
        """请分析以下文本中提到的两个或多个概念，并提出一个关于它们异同点的问题。\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ],
    "apply_q": [
         """根据以下文本，生成一条应用或方法步骤类考题，问题描述应要求说明‘如何/怎样/步骤/方法’，并给出结构化答案：\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n""",
         """假设你需要应用以下文本中描述的方法来解决一个问题，请设计一个相关的问题，并给出操作步骤作为答案。\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ],
    "calculate_q": [
        """如果原文中存在公式、数值或推导背景，则生成一条计算或推导类考题（不虚构数据），并给出正确答案；否则回退到概念理解题：\n原文：{text}\n\n输出格式：\n问题：...？\n答案：...\n"""
    ]
}

# ========== 新增一个辅助函数 ==========
def get_random_prompt(prompt_key: str) -> str:
    """
    根据给定的 key, 从 QA_PROMPTS 字典中获取模板列表，并随机返回其中一个。
    如果 key 不存在或对应的值不是列表，则安全地回退到 generic_q。
    """
    # 优先使用指定的 key
    prompt_list = QA_PROMPTS.get(prompt_key)
    
    # 如果找不到，或者找到的不是一个列表，则回退
    if not isinstance(prompt_list, list) or not prompt_list:
        prompt_list = QA_PROMPTS.get("generic_q")
        
    return random.choice(prompt_list)